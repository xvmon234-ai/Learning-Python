# **02. Financial Ratio Calculation: Financial Risk Prediction**

이 단계는 재무 위험 예측 모델 구축을 위해 1단계에서 수집한 원시 재무 데이터를 활용하여 재무 비율을 계산하고, 분석에 적합한 형태로 가공하는 과정입니다.

#### **Summary of This Step**

1.  **데이터 재수집**: 분석의 독립성을 위해 1단계의 데이터 수집 코드를 다시 실행하여 필요한 데이터를 확보했습니다.
2.  **재무 비율 계산**: 유동성, 수익성, 레버리지 비율 등 감사 실무에서 핵심적인 지표들을 계산했습니다.
3.  **데이터 통합 및 정리**: 계산된 재무 비율 데이터를 하나의 DataFrame으로 통합하고, 향후 분석에 용이하도록 정리했습니다.

#### **Detailed Descriptions**

##### **1. 데이터 수집 및 전처리**

재무 비율 계산에 앞서 `yfinance`를 활용해 기업별 재무제표를 다시 불러왔습니다. 이 과정에서 각 기업의 재무 데이터는 `financial_data`라는 **딕셔너리(`{}`)**에 저장되었습니다.

> **💡 파이썬 이론 - 딕셔너리(`{}`)**
> 딕셔너리는 **'키(key)'**와 **'값(value)'**의 쌍으로 이루어진 자료형입니다. `financial_data`에서는 기업의 **티커**가 키가 되고, 그 기업의 재무제표가 **값**이 됩니다. `financial_data[ticker]`와 같이 대괄호에 키를 넣어 원하는 값을 빠르게 꺼낼 수 있습니다.

##### **2. 핵심 재무 비율 계산**

수집된 재무 데이터프레임을 바탕으로 아래 재무 비율들을 계산했습니다. 각 비율은 기업의 재무 건전성을 평가하는 데 중요한 지표입니다.

* **유동성 비율**: 단기 채무 상환 능력을 평가합니다.
    * **유동비율(Current Ratio)** = `유동자산` / `유동부채`
    * **당좌비율(Quick Ratio)** = (`유동자산` - `재고자산`) / `유동부채`
        * **추가 학습**: META와 같이 재고가 없는 기업의 경우, 재고자산을 0으로 간주하여 유동비율과 당좌비율이 동일해지는 것을 코드로 구현했습니다. 이는 기업의 산업 특성을 고려한 유연한 코딩 방식입니다.

* **수익성 비율**: 영업 활동의 효율성을 평가합니다.
    * **매출총이익률(Gross Profit Margin)** = `매출총이익` / `매출액`
    * **영업이익률(Operating Profit Margin)** = `영업이익` / `매출액`

* **레버리지 비율**: 타인자본 의존도(부채)를 평가합니다.
    * **부채비율(Debt Ratio)** = `총부채` / `총자본`

##### **3. 데이터 통합 및 이론적 배경**

계산된 재무 비율들은 각 기업별로 별도의 DataFrame에 저장된 후, `pd.concat` 함수를 사용하여 하나의 큰 DataFrame으로 통합되었습니다.

> **💡 파이썬 이론 - `df.copy()`와 데이터 통합**
>
> * **`.copy()`**: `income_df = financial_data[ticker]['income_stmt'].copy()`와 같이 `.copy()`를 사용하는 것은 매우 중요합니다. 이는 원본 데이터(딕셔너리에 저장된 DataFrame)를 수정하지 않고, **독립적인 복사본**을 만들어 작업하기 위함입니다. 파이썬에서 변수를 할당할 때 원본의 메모리 주소를 공유하는 **참조(reference)** 방식이 기본이므로, `.copy()`를 통해 원본 데이터 손상을 방지합니다.
>
> * **`pd.concat()`**: 여러 개의 DataFrame을 행(row)이나 열(column) 방향으로 통합할 때 사용하는 함수입니다. 이 프로젝트에서는 각 기업의 재무 비율 DataFrame을 위아래로 합쳐서 하나의 테이블로 만들었습니다. 이때 `names=['Ticker', 'Date']` 옵션을 사용해 통합된 데이터프레임의 인덱스에 **멀티인덱스(Multi-Index)**를 부여하여 데이터 검색의 효율성을 높였습니다.

##### **4. 추가 학습 내용**

이 단계에서 마주쳤던 개념들을 더 깊이 이해하기 위해 다음과 같은 내용을 학습하는 것을 추천합니다.

* **Pandas 데이터 선택**: `df[]`, `df.loc[]`, `df.iloc[]`의 차이를 이해하고 자유자재로 사용할 수 있어야 합니다.
* **예외 처리(Exception Handling)**: `try`와 `except` 구문을 활용하여 예기치 않은 오류(데이터 누락, API 연결 실패 등)가 발생해도 프로그램이 안정적으로 작동하도록 만드는 방법을 익히세요. 이는 실무 환경에서 매우 중요한 능력입니다.
